---
description: "Start autonomous development workflow with intelligent delegation and multi-agent review"
argument-hint: '"<feature description>" [--max-iterations N] [--no-worktree] [--auto-merge]'
allowed-tools: ["Bash", "Glob", "Grep", "Read", "Write", "Edit", "Task", "TaskCreate", "TaskUpdate", "TaskList", "TaskGet"]
---

# Auto-Dev Command

Execute the setup script to initialize the auto-dev session:

```!
"${CLAUDE_PLUGIN_ROOT}/scripts/setup-auto-dev.sh" $ARGUMENTS
```

---

## Autonomous Development Workflow

You are now running an autonomous development workflow. Follow these phases exactly.

### Phase 1: SETUP (Current)

1. Run project detection:
   ```bash
   "${CLAUDE_PLUGIN_ROOT}/scripts/detect-project.sh"
   ```

2. Update `.claude/auto-dev.local.md` with detected stack and complexity

3. Transition to PLANNING phase by updating `current_phase: "PLANNING"` in state file

### Phase 2: PLANNING

**REQUIRED:** Invoke these skills in order:

1. **superpowers:brainstorming** - Explore requirements, edge cases, and design decisions
2. **superpowers:writing-plans** - Create detailed implementation plan with bite-sized tasks

Update state file: `current_phase: "PLANNING"`, `phase_status: "in_progress"`

When plan is complete, transition to DEVELOPMENT.

### Phase 3: DEVELOPMENT

Execute the plan task by task. Use specialist delegation based on complexity:

#### Delegation Heuristics

| Condition | Delegate To |
|-----------|-------------|
| React hooks/state/components | `react-specialist` |
| TypeScript generics/advanced types | `typescript-pro` |
| Architecture decisions | `feature-dev:code-architect` |
| Database schema/queries | `postgres-pro` or `database-administrator` |
| Multi-file exploration needed | `feature-dev:code-explorer` |
| API design | `api-designer` |
| Security concerns | `security-engineer` |
| Performance optimization | `database-optimizer` or `dx-optimizer` |
| Frontend UI/UX | `frontend-developer` or `ui-designer` |
| Backend logic | `backend-developer` |
| **Mobile/Expo navigation** | `mobile-developer` or `mobile-app-developer` |
| **Expo-specific features** | Use `expo-app-design:*` skills |
| **React Native components** | `mobile-developer` |
| **Supabase integration** | Use Supabase MCP tools |

#### Mobile Development Skills

When the detected stack includes `expo`, `react-native`, or `supabase`:

**Expo Skills (invoke when applicable):**
- `expo-app-design:building-native-ui` - Native UI components, navigation, styling
- `expo-app-design:native-data-fetching` - API calls, React Query, offline support
- `expo-app-design:expo-api-routes` - API routes with EAS Hosting
- `expo-app-design:expo-dev-client` - Development builds and TestFlight
- `expo-app-design:use-dom` - DOM components for web code on native
- `expo-app-design:expo-tailwind-setup` - Tailwind CSS with NativeWind

**Supabase Integration:**
- Use `mcp__plugin_supabase_supabase__*` tools for database operations
- `execute_sql` for queries, `apply_migration` for schema changes
- `get_project_url` and `get_publishable_keys` for client setup

**Complexity Thresholds:**
- Score 1-3: Handle directly, minimal delegation
- Score 4-6: Delegate complex subtasks to specialists
- Score 7-10: Heavy delegation, use code-architect for coordination

Track progress in state file under `phases.DEVELOPMENT.tasks`

### Phase 4: CLEANUP

Before PR creation:
1. Run code simplification review
2. Remove dead code, unused imports
3. Ensure consistent formatting
4. Verify all tests pass

Update state: `current_phase: "CLEANUP"`

### Phase 5: PR_CREATION

Create pull request using gh CLI:

```bash
gh pr create --title "<concise title>" --body "$(cat <<'EOF'
## Summary
<bullet points of changes>

## Test plan
<how to verify>

---
Generated by Auto-Dev
EOF
)"
```

Update state with PR number: `phases.PR_CREATION.result.pr_number`

### Phase 6: REVIEW (Review Battle)

Launch 4 review agents in parallel using the Task tool:

```
Task(pr-review-toolkit:code-reviewer, "Review PR #N for code quality")
Task(pr-review-toolkit:code-simplifier, "Review PR #N for simplification opportunities")
Task(pr-review-toolkit:silent-failure-hunter, "Review PR #N for error handling issues")
Task(pr-review-toolkit:pr-test-analyzer, "Review PR #N for test coverage")
```

**IMPORTANT:** Dispatch all 4 agents in a SINGLE message with multiple Task tool calls.

After agents complete, run vote aggregation:
```bash
"${CLAUDE_PLUGIN_ROOT}/scripts/aggregate-votes.sh" <round_number>
```

**Voting Rules:**
- 3/4 approvals = proceed to merge
- Any critical issue = blocks even with majority approval
- Max 5 review rounds before human escalation

If `needs-fixes`: Address issues and re-run review round
If `blocked`: Fix critical issues first

### Phase 7: MERGE

Before merging, run pre-merge checks:
```bash
"${CLAUDE_PLUGIN_ROOT}/scripts/pre-merge-checks.sh" <pr_number>
```

If all checks pass and `--auto-merge` was set:
```bash
gh pr merge <pr_number> --squash --delete-branch
```

Otherwise, report ready status and wait for human approval.

---

## Completion

When all phases complete successfully, output:

```
<promise>AUTO-DEV COMPLETE</promise>
```

**CRITICAL:** Only output this when the feature is truly complete:
- All code implemented
- All tests passing
- PR created (and merged if auto-merge enabled)
- No outstanding issues

Do NOT output false completion promises to exit the loop.

---

## State Management

Always keep `.claude/auto-dev.local.md` updated:
- `current_phase`: Current workflow phase
- `phase_status`: "pending", "in_progress", "completed"
- `total_iterations`: Incremented by stop hook
- `specialists.invoked`: Track which agents were used
- `review_tracking`: Track review rounds and votes

---

## Error Recovery

If you encounter errors:
1. Log the error in state file
2. Attempt recovery (retry, alternative approach)
3. If unrecoverable, document the blocker
4. Do NOT output completion promise if blocked

The loop will continue until completion or max iterations.
